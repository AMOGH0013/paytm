<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <title>Paytm Ticket</title>

  <!-- fonts & icons -->
  <link rel="preconnect" href="https://fonts.googleapis.com">
  <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
  <link href="https://fonts.googleapis.com/css2?family=Roboto:wght@400;500;700&display=swap" rel="stylesheet">
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.5.1/css/all.min.css">

  <style>
    body { margin:0; padding:0; font-family:'Roboto',sans-serif; background:#f0f2f5; display:flex; justify-content:center; align-items:flex-start; }
    .mobile-screen { width:100%; max-width:430px; min-height:100vh; background:linear-gradient(to bottom,#d7efff,#f5f7fa 40%); display:flex; flex-direction:column; position:relative; }
    .main-header { padding:15px; display:flex; justify-content:space-between; align-items:center; }
    .paytm-logo { height:31px; object-fit:contain; display:inline-block; vertical-align:middle; }
    .transport-logo { height:75px; width:75px; margin-bottom:20px; object-fit:contain; }
    .content { padding:20px 20px 100px 20px; text-align:center; }
    .route { font-size:24px; font-weight:700; color:#333; }
    .bus-details { font-size:16px; color:#666; margin-top:6px; }
    .ticket-count { font-size:16px; color:#333; margin-top:10px; }
    .avatar-container { margin-top:25px; display:flex; flex-direction:column; align-items:center; }
    .avatar-number { background:#002e6e; color:white; border-radius:50%; width:24px; height:24px; display:flex; justify-content:center; align-items:center; font-weight:700; font-size:14px; border:2px solid white; position:relative; top:-15px; left:15px; }
    .price-section { font-size:48px; font-weight:700; color:#333; display:flex; justify-content:center; align-items:center; gap:10px; margin-top:-10px; }
    .status-message { color:#2dd68a; font-weight:700; margin-top:5px; }
    .timestamp { color:#666; font-size:14px; margin-top:5px; }
    .separator { border:none; border-bottom:1px dashed #ccc; width:100%; margin:25px 0; }
    .validity-card { background:white; border-radius:12px; padding:20px; width:100%; box-sizing:border-box; border-top:4px solid #00baf2; }
    .time-value { font-size:40px; font-weight:700; color:#333; }
    .view-tickets-btn { background:#00baf2; color:white; border:none; border-radius:8px; padding:15px; width:100%; font-weight:700; margin-top:10px; cursor:pointer; }
    .main-footer { background:#002e6e; display:flex; justify-content:space-around; position:absolute; bottom:20px; left:50%; transform:translateX(-50%); width:85%; height:65px; border-radius:35px; align-items:center; color:white; }
    .fallback-text { font-weight:700; color:#00baf2; font-size:18px; }
    .logo-wrapper { display:inline-block; min-width:80px; min-height:30px; }
  </style>
</head>
<body>
  <div class="mobile-screen">
    <header class="main-header">
      <i class="fas fa-arrow-left" onclick="history.back()" style="cursor:pointer"></i>

      <!-- Paytm logo img: we provide onerror fallback handling below -->
      <div class="logo-wrapper">
        <img id="paytmLogo" src="images/paytm_logo.png" alt="Paytm" class="paytm-logo"
             data-alt='["images/paytm_logo.png.png","images/paytm_logo.svg"]'>
      </div>

      <div>
        <a id="editLink" class="edit-link" href="#" style="color:#00baf2; text-decoration:none; font-weight:500; margin-right:8px;">Edit</a>
        <a href="#" class="help-link" style="color:#00baf2; text-decoration:none;">Help</a>
      </div>
    </header>

    <main class="content">
      <!-- KTCL logo with fallback -->
      <div id="ktclWrapper">
        <img id="ktclLogo" src="images/ktcl_logo.png" alt="KTCL" class="transport-logo" data-alt='["images/ktcl_logo.png.png","images/ktcl_logo.svg"]'>
      </div>

      <p class="route">Panaji → Margao</p>
      <p class="bus-details">Shuttle · Non AC</p>
      <p class="ticket-count">1 Adult Ticket</p>

      <div class="avatar-container">
        <i class="fa-regular fa-circle-user" style="font-size:48px;color:#ffad33;"></i>
        <div class="avatar-number">1</div>
      </div>

      <div class="price-section">
        <span id="priceSpan">&#8377;45</span>
        <i class="fas fa-check-circle" style="color:#2dd68a;font-size:32px;"></i>
      </div>

      <p class="status-message">TICKET BOOKED SUCCESSFULLY</p>
      <p class="timestamp" id="current-datetime"></p>

      <hr class="separator">

      <div class="validity-card">
        <p>Your ticket is valid for</p>
        <div style="display:flex;justify-content:center;gap:20px;margin:15px 0;">
          <div style="text-align:center;">
            <div id="hours" class="time-value">02</div><div style="font-size:12px;color:#999">Hours</div>
          </div>
          <div style="text-align:center;">
            <div id="minutes" class="time-value">25</div><div style="font-size:12px;color:#999">Minutes</div>
          </div>
          <div style="text-align:center;">
            <div id="seconds" class="time-value">04</div><div style="font-size:12px;color:#999">Seconds</div>
          </div>
        </div>
        <button class="view-tickets-btn">View your Tickets</button>
      </div>
    </main>

    <footer class="main-footer">
      <div style="text-align:center;"><i class="fas fa-home" style="font-size:20px;"></i><div style="font-size:12px;">Home</div></div>
      <div style="text-align:center; position:relative;"><div style="background:#ffa400;color:#002e6e;font-size:8px;font-weight:700;padding:2px 4px;border-radius:4px;position:absolute;top:-12px;left:50%;transform:translateX(-50%);">CASHBACK</div><i class="fas fa-tags" style="font-size:20px;"></i><div style="font-size:12px;">CashBack</div></div>
      <div style="text-align:center;"><i class="fas fa-question-circle" style="font-size:20px;"></i><div style="font-size:12px;">Help</div></div>
    </footer>
  </div>

  <script>
    // --- Image fallback loader: attempts alternatives then falls back to text/SVG ---
    function setupImageFallback(imgEl, wrapperEl) {
      const alts = (() => {
        try { return JSON.parse(imgEl.getAttribute('data-alt') || '[]'); } catch(e) { return []; }
      })();
      let attempt = 0;

      imgEl.addEventListener('error', function () {
        if (attempt < alts.length) {
          imgEl.src = alts[attempt++];
          return;
        }
        // final fallback: replace image with a text/SVG placeholder
        const parent = wrapperEl || imgEl.parentNode;
        if (!parent) return;
        const fallback = document.createElement('div');
        fallback.style.display = 'inline-flex';
        fallback.style.alignItems = 'center';
        fallback.style.justifyContent = 'center';
        fallback.style.width = imgEl.style.width || '90px';
        fallback.style.height = imgEl.style.height || '30px';
        fallback.innerHTML = `<svg xmlns="http://www.w3.org/2000/svg" width="140" height="36" viewBox="0 0 140 36" role="img">
          <rect rx="6" width="140" height="36" fill="#e9f7ff"></rect>
          <text x="50%" y="50%" dominant-baseline="middle" text-anchor="middle"
                font-family="Arial, Helvetica, sans-serif" font-size="14" fill="#00baf2">LOGO</text>
        </svg>`;
        parent.replaceChild(fallback, imgEl);
      });
    }

    // set up fallbacks for both logos
    document.addEventListener('DOMContentLoaded', () => {
      const paytm = document.getElementById('paytmLogo');
      const ktcl = document.getElementById('ktclLogo');
      setupImageFallback(paytm);
      setupImageFallback(ktcl, document.getElementById('ktclWrapper'));

      // parse query params
      const params = new URLSearchParams(window.location.search);
      const from = params.get('from');
      const to = params.get('to');
      const rawBusType = params.get('busType') || '';
      const tickets = Number(params.get('tickets') || '1');
      const amount = params.get('amount') || '';

      // if required fields missing, redirect to form (or comment out to show defaults)
      if (!from || !to) {
        window.location.href = 'form.html';
        return;
      }

      // route
      const routeEl = document.querySelector('.route');
      routeEl.textContent = `${from} → ${to}`;

      // busType can be "EV,AC" or "EV AC" etc. Normalize to array.
      const busTypes = rawBusType
        .split(',')
        .map(s => s.trim())
        .filter(Boolean);

      const busDetailsEl = document.querySelector('.bus-details');
      if (busTypes.length === 0) {
        busDetailsEl.textContent = 'Shuttle · Non AC';
      } else {
        // display joined types; if multiple show separator bullet
        busDetailsEl.textContent = busTypes.join(' · ');
      }

      // ticket count and avatar
      const ticketCountEl = document.querySelector('.ticket-count');
      ticketCountEl.textContent = `${tickets} Adult Ticket${tickets > 1 ? 's' : ''}`;
      const avatarNumEl = document.querySelector('.avatar-number');
      avatarNumEl.textContent = String(tickets);

      // amount
      if (amount !== '') {
        document.getElementById('priceSpan').innerHTML = '&#8377;' + amount;
      }

      // populate Edit link to go back with same params
      const editLink = document.getElementById('editLink');
      const qs = new URLSearchParams({
        from: from,
        to: to,
        busType: rawBusType,
        tickets: tickets,
        amount: amount
      }).toString();
      editLink.setAttribute('href', `form.html?${qs}`);

      // set timestamp
      formatCurrentDateTime();

      // start countdown using existing DOM values
      startCountdownFromDOM();
    });

    // existing countdown logic (keeps the initial values in DOM)
    function startCountdownFromDOM() {
      const hoursElem = document.getElementById('hours');
      const minutesElem = document.getElementById('minutes');
      const secondsElem = document.getElementById('seconds');

      let totalSeconds =
        parseInt(hoursElem.textContent || '0', 10) * 3600 +
        parseInt(minutesElem.textContent || '0', 10) * 60 +
        parseInt(secondsElem.textContent || '0', 10);

      function updateTimer() {
        if (totalSeconds < 0) { clearInterval(timerInterval); return; }
        const h = Math.floor(totalSeconds / 3600);
        const m = Math.floor((totalSeconds % 3600) / 60);
        const s = totalSeconds % 60;
        hoursElem.textContent = h < 10 ? '0' + h : h;
        minutesElem.textContent = m < 10 ? '0' + m : m;
        secondsElem.textContent = s < 10 ? '0' + s : s;
        totalSeconds--;
      }
      updateTimer();
      const timerInterval = setInterval(updateTimer, 1000);
    }

    function formatCurrentDateTime() {
      const now = new Date();
      const options = { day:'2-digit', month:'short', year:'numeric', hour:'2-digit', minute:'2-digit', hour12:true };
      let formatted = new Intl.DateTimeFormat('en-GB', options).format(now);
      formatted = formatted.replace(' at ', ', ');
      const el = document.getElementById('current-datetime');
      if (el) el.textContent = formatted;
    }
  </script>
</body>
</html>
